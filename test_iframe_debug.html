<!DOCTYPE html>
<html>
<head>
    <title>Iframe Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        iframe { width: 100%; height: 400px; border: 1px solid #ccc; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Iframe Debug Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Direct Resource Access</h2>
        <div id="direct-test-log" class="log">Testing direct resource access...</div>
        <button onclick="testDirectAccess()">Test Direct Access</button>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Iframe with Network Monitoring</h2>
        <div id="iframe-log" class="log">Loading iframe...</div>
        <iframe id="test-iframe" src="/pseudo_compiler/build/index.html"></iframe>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Manual Resource Loading</h2>
        <div id="manual-test-log" class="log">Ready to test manual loading...</div>
        <button onclick="testManualLoading()">Test Manual Loading</button>
    </div>

    <script>
        // Log function
        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
        }

        // Test direct access to resources
        async function testDirectAccess() {
            const resources = [
                '/pseudo_compiler/build/static/js/main.d78c9f8b.js',
                '/pseudo_compiler/build/static/css/main.ea10bb14.css',
                '/pseudo_compiler/build/index.html'
            ];
            
            for (const resource of resources) {
                try {
                    const response = await fetch(resource, { method: 'HEAD' });
                    log('direct-test-log', `${resource}: ${response.status} ${response.statusText}`);
                } catch (error) {
                    log('direct-test-log', `${resource}: ERROR - ${error.message}`, true);
                }
            }
        }

        // Test manual loading of resources
        function testManualLoading() {
            // Test loading JS
            const script = document.createElement('script');
            script.src = '/pseudo_compiler/build/static/js/main.d78c9f8b.js';
            script.onload = () => log('manual-test-log', 'JS loaded successfully');
            script.onerror = (e) => log('manual-test-log', 'JS failed to load: ' + e.message, true);
            document.head.appendChild(script);
            
            // Test loading CSS
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = '/pseudo_compiler/build/static/css/main.ea10bb14.css';
            link.onload = () => log('manual-test-log', 'CSS loaded successfully');
            link.onerror = (e) => log('manual-test-log', 'CSS failed to load: ' + e.message, true);
            document.head.appendChild(link);
        }

        // Monitor iframe loading
        const iframe = document.getElementById('test-iframe');
        
        iframe.onload = function() {
            log('iframe-log', 'Iframe load event fired');
            
            // Try to access iframe content
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                log('iframe-log', 'Iframe document accessible');
                
                // Check for script and link tags
                const scripts = iframeDoc.querySelectorAll('script[src]');
                const links = iframeDoc.querySelectorAll('link[href]');
                
                log('iframe-log', `Found ${scripts.length} script tags, ${links.length} link tags`);
                
                scripts.forEach((script, index) => {
                    log('iframe-log', `Script ${index + 1}: ${script.src}`);
                });
                
                links.forEach((link, index) => {
                    if (link.rel === 'stylesheet') {
                        log('iframe-log', `CSS ${index + 1}: ${link.href}`);
                    }
                });
                
            } catch (error) {
                log('iframe-log', 'Cannot access iframe content: ' + error.message, true);
            }
        };
        
        iframe.onerror = function(e) {
            log('iframe-log', 'Iframe error event: ' + e.message, true);
        };

        // Monitor network errors (if possible)
        window.addEventListener('error', function(e) {
            if (e.target && (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
                log('iframe-log', `Resource error: ${e.target.src || e.target.href}`, true);
            }
        }, true);

        // Initial direct access test
        setTimeout(testDirectAccess, 1000);
    </script>
</body>
</html>